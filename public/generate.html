<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¬¸ì œ ìƒì„± íˆ´</title>
<style>
  html {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    overflow-x: hidden;
  }

  body {
    margin: 20px;
    font-family: sans-serif;
    background-color: #f9f9f9;
    overflow-x: hidden;
    box-sizing: border-box;
  }

  .container {
    width: 100%;
    max-width: 800px;
    margin: auto;
    display: flex;
    flex-direction: column;
    gap: 16px;
    box-sizing: border-box;
  }

  textarea {
    width: 100%;
    height: 220px;
    resize: none;
    padding: 10px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
    background-color: #fff;
    font-family: inherit;
  }

  .switches {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .switches input {
    display: none;
  }

  .switches label {
    padding: 8px 12px;
    font-size: 13px;
    background: #fff;
    border: 1px solid #666;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
    color: black;
    font-family: inherit;
  }

  .switches input:checked + label {
    background: #333;
    color: white;
  }

  button {
    width: 100%;
    padding: 12px;
    font-size: 15px;
    font-weight: bold;
    background: #fff;
    color: black;
    border: 1px solid #666;
    border-radius: 4px;
    cursor: pointer;
    font-family: inherit;
  }

  button:hover {
    background-color: #eee;
  }

  #progressStatus {
    font-size: 14px;
    font-weight: bold;
    text-align: right;
  }

.output {
  background: transparent;
  border: none;
  border-radius: 0;
  padding: 10px;
  font-family: "Times New Roman", Times, serif;
  font-size: 14px;
  white-space: pre-wrap;
  max-height: 600px; 
  overflow-y: auto;
}



  pre {
    font-family: "Times New Roman", Times, serif;
    white-space: pre-wrap;
    margin-bottom: 20px;
  }

  .error {
    color: red;
    font-weight: bold;
  }
#consentPopup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.6);
  display: none; /* ì´ˆê¸° ìˆ¨ê¹€ */
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.popup-content {
  background: white;
  padding: 20px 30px;
  border-radius: 10px;
  text-align: left;
  width: 90%;
  max-width: 600px;         /* ìµœëŒ€ ê°€ë¡œí­ ì œí•œ */
  max-height: 80vh;         /* ìµœëŒ€ ë†’ì´ ì œí•œ */
  overflow-y: auto;         /* ë‚´ìš© ë„˜ì¹˜ë©´ ìŠ¤í¬ë¡¤ */
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.25);
}

.popup-content p,
.popup-content li {
  margin-bottom: 12px;
  font-size: 15px;
  line-height: 1.5;
}

.popup-content button {
  margin-top: 20px;
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
}

</style>

</head>
<body>
  <div class="container">
    <textarea id="inputText" placeholder="ì˜ì–´ ì§€ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>

    <div class="switches" id="typeSwitches"></div>

    <button id="generateBtn">ë¬¸ì œ ìƒì„±</button>

    <div id="progressStatus"></div>

    <div class="output" id="outputBox"></div>
  </div>
  <div id="consentPopup" style="display: flex;">
  <div id="consentPopup" style="display: flex;">
  <div class="popup-content">
    <h2>AI ê¸°ë°˜ ë¬¸í•­ ìë™ ìƒì„±ê¸° ì´ìš© ë™ì˜ ì•ˆë‚´</h2>
    <p>ë³¸ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ê²½ìš° ì•„ë˜ ë‚´ìš©ì„ ì½ê³  ë™ì˜í•˜ì‹  ê²ƒìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤:</p>

    <ol>
      <li>
        <strong>ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë‚´ì—­</strong><br>
        ë³¸ ì„œë¹„ìŠ¤ëŠ” ì´ë¦„, ì—°ë½ì²˜ ë“± ì–´ë– í•œ ê°œì¸ì •ë³´ë„ ìˆ˜ì§‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </li>

      <li>
        <strong>ìƒì„± ë¬¸í•­ ì €ì‘ê¶Œ ê´€ë ¨ ë™ì˜</strong><br>
        ìƒì„±ëœ ë¬¸í•­ì€ ìƒì„±ê¸°ì˜ ì•Œê³ ë¦¬ì¦˜ì— ì˜í•´ ìë™ ìƒì„±ëœ ì½˜í…ì¸ ë¡œ, ì‚¬ìš©ìëŠ” í•´ë‹¹ ë¬¸í•­ì— ëŒ€í•´ ì €ì‘ê¶Œì´ë‚˜ 2ì°¨ ì €ì‘ê¶Œì„ ì£¼ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
        <ul>
          <li><strong>í—ˆìš©ëœ ìš©ë„:</strong> ê°œì¸ ìˆ˜ì—… ë˜ëŠ” í•™ìŠµìš©ìœ¼ë¡œ ììœ ë¡­ê²Œ í™œìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
          <li><strong>ê¸ˆì§€ëœ ìš©ë„:</strong> ìƒì„±ëœ ë¬¸í•­ì„ ë³µì œ, í¸ì§‘í•˜ì—¬ ìƒì—…ì  ìš©ë„ë¡œ íŒë§¤í•˜ê±°ë‚˜ ë°°í¬í•˜ëŠ” ê²ƒì€ ê¸ˆì§€ë©ë‹ˆë‹¤.</li>
        </ul>
      </li>

      <li>
        <strong>ìƒì—…ì  ì´ìš© ì œí•œ ë° ìœ„ë°˜ ì‹œ ì±…ì„</strong><br>
        ë³¸ ë™ì˜ì— ë°˜í•˜ì—¬ ìƒì„±ëœ ë¬¸í•­ì„ ë¬´ë‹¨ íŒë§¤í•˜ê±°ë‚˜ ìƒì—…ì ìœ¼ë¡œ ì´ìš©í•  ê²½ìš° ë°œìƒí•˜ëŠ” ì €ì‘ê¶Œ ê´€ë ¨ ë²•ì  ì±…ì„ì€ ì‚¬ìš©ì ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤.
      </li>

      <li>
        <strong>ë¬¸í•­ í’ˆì§ˆì— ëŒ€í•œ ì•ˆë‚´</strong><br>
        ìƒì„±ë˜ëŠ” ë¬¸í•­ì€ ì§€ë¬¸ê³¼ ë¬¸ì œ ìœ í˜•ì— ë”°ë¼ í’ˆì§ˆì´ ì¼ì •í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </li>

      <li>
        <strong>ìƒì„± ë¬¸í•­ ìë™ ì €ì¥ ë° ì‚¬ìš© ëª©ì </strong><br>
        ìƒì„±ëœ ë¬¸í•­ì€ ìƒì„±ê¸° ë¡œì§ ê°œì„ ê³¼ ì˜¤ë¥˜ ë¶„ì„(ë””ë²„ê¹…)ì„ ìœ„í•´ ìƒì„± ì¦‰ì‹œ ì„œë²„ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤.
      </li>

      <li>
        <strong>ë¬¸ì˜ ë° í”¼ë“œë°±</strong><br>
        ë¬¸í•­ ê´€ë ¨ ë¬¸ì˜ë‚˜ ë¬¸í•­ ìƒì„±ê¸° ì´ìš© ê´€ë ¨ ë¬¸ì˜:<br>
        ğŸ“± 010-7905-3423<br>
        ğŸ“§ <a href="mailto:studentofe@gmail.com">studentofe@gmail.com</a>
      </li>
    </ol>

    <button id="agreeBtn">ë™ì˜í•©ë‹ˆë‹¤</button>
  </div>
</div>
</div>

<script>
  document.getElementById('consentPopup').style.display = 'flex';
document.getElementById('agreeBtn').addEventListener('click', () => {
  document.getElementById('consentPopup').style.display = 'none';
});
  
  if (window.top === window.self) {
    document.body.innerHTML = "ì´ í˜ì´ì§€ëŠ” iframeì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.";
    throw new Error("Blocked: not in iframe");
  }

  const allowedHost = "https://easyenough.tistory.com";
  if (!document.referrer.startsWith(allowedHost)) {
    document.body.innerHTML = "ì ‘ê·¼ì´ í—ˆìš©ë˜ì§€ ì•Šì€ ì¶œì²˜ì…ë‹ˆë‹¤.";
    throw new Error("Blocked: invalid referrer");
  }

  const TYPES = [
    'ìš”ì§€', 'ìš”ì§€(ì˜)', 'ì£¼ì œ', 'ì œëª©', 'ìš”ì•½', 'íë¦„', 'í•¨ì¶•ì˜ë¯¸',
    'ì–´ë²•', 'ì–´ë²•ABC', 'ì–´íœ˜', 'ì–´íœ˜ABC', 'ë¶ˆì¼ì¹˜', 'ë¶ˆì¼ì¹˜(ì˜)', 'ë¹ˆì¹¸(ë‹¨ì–´)', 'ë¹ˆì¹¸(ì–´êµ¬)'
  ];
  const TYPE_KEYS = [
    'gist', 'giste', 'topic', 'title', 'summary', 'flow', 'implication',
    'grammar', 'grammarabc', 'vocab', 'vocababc', 'detail', 'detaile', 'blanka', 'blankb'
  ];

  window.onload = () => {
    const container = document.getElementById('typeSwitches');
    TYPES.forEach((label, i) => {
      const id = 'type_' + TYPE_KEYS[i];
      const input = document.createElement('input');
      input.type = 'checkbox';
      input.id = id;
      input.value = TYPE_KEYS[i];

      const labelEl = document.createElement('label');
      labelEl.htmlFor = id;
      labelEl.textContent = label;

      container.appendChild(input);
      container.appendChild(labelEl);
    });
  };

  function escapeHTML(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  function underlineAngleBracketsBeforeEscape(text) {
    const withUnderline = text.replace(/<([^>]+)>/g, '<u>$1</u>');
    const token = '___TAG___';
    let tmp = withUnderline
      .replace(/<u>/g, token + 'OPEN___')
      .replace(/<\/u>/g, token + 'CLOSE___');

    const escaped = escapeHTML(tmp);
    return escaped
      .replace(new RegExp(token + 'OPEN___', 'g'), '<u>')
      .replace(new RegExp(token + 'CLOSE___', 'g'), '</u>');
  }

  document.getElementById('generateBtn').addEventListener('click', async () => {
    const text = document.getElementById('inputText').value.trim();
    const outputBox = document.getElementById('outputBox');
    const progressStatus = document.getElementById('progressStatus');
    outputBox.innerHTML = '';
    progressStatus.textContent = '';

    if (!text) {
      outputBox.innerHTML = '<p class="error">ì§€ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”.</p>';
      return;
    }
      const wordCount = text.split(/\s+/).length;
  if (wordCount > 300) {
    outputBox.innerHTML = '<p class="error">300ë‹¨ì–´ ë¯¸ë§Œìœ¼ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>';
    return;
  }
    const selected = Array.from(document.querySelectorAll('.switches input:checked')).map(e => e.value);
    if (selected.length === 0) {
      outputBox.innerHTML = '<p class="error">ìœ í˜•ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•˜ì„¸ìš”.</p>';
      return;
    }

    progressStatus.textContent = '0%';

    for (let i = 0; i < selected.length; i++) {
      const type = selected[i];
      try {
        const res = await fetch(`/api/${type}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });

        const data = await res.json();
        const pre = document.createElement('pre');
        pre.innerHTML = `${i + 1}. ${underlineAngleBracketsBeforeEscape(data.problem || '')}<br><br>${underlineAngleBracketsBeforeEscape(data.explanation || '')}`;
        outputBox.appendChild(pre);

        // ì‹œíŠ¸ ì „ì†¡ì€ ë¬¸ì œ ìƒì„± í›„ ë”°ë¡œ ì²˜ë¦¬
        try {
await fetch('/api/save', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    problem: data.problem,
    answer: data.answer,
    explanation: data.explanation
  })
});

        } catch (sheetErr) {
          const sheetMsg = document.createElement('div');
          sheetMsg.textContent = `${i + 1}ë²ˆ ë¬¸ì œëŠ” ì‹œíŠ¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`;
          sheetMsg.style.color = 'orange';
          outputBox.appendChild(sheetMsg);
        }

      } catch (err) {
        const pre = document.createElement('pre');
        pre.textContent = `${i + 1}ë²ˆ ë¬¸ì œ ìƒì„± ì‹¤íŒ¨`;
        pre.style.color = 'red';
        outputBox.appendChild(pre);
      }

      const percent = Math.floor(((i + 1) / selected.length) * 100);
      progressStatus.textContent = `${percent}%`;
    }
  });
</script>


</body>
</html>
